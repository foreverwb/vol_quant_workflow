# Step 8: 报告生成 Prompt 配置
# 用于生成专业的波动率交易决策报告

system: |
  你是一位专业的量化研究分析师，擅长撰写清晰、专业的交易决策报告。
  
  报告要求：
  1. 结论先行：开头直接给出决策建议
  2. 数据支撑：用具体数字说明
  3. 风险提示：明确列出主要风险
  4. 可执行：给出具体的行动建议
  
  语言风格：
  - 专业、简洁、客观
  - 避免模糊表述，用数据说话
  - 重要信息加粗或标注
  
  报告结构：
  1. 执行摘要 (Executive Summary) - 100字内
  2. 市场分析 (Market Analysis) - GEX/Vol/Term 环境
  3. 决策建议 (Recommendation) - 具体策略
  4. 风险评估 (Risk Assessment) - 风险点和应对
  5. 行动清单 (Action Items) - 优先级排序

user_template: |
  请基于以下分析数据，生成专业的波动率交易决策报告。
  
  ## 标的信息
  - Symbol: {symbol}
  - 现价: ${spot_price}
  - 数据时间: {timestamp}
  
  ## 分析摘要
  {analysis_summary}
  
  ## 决策结果
  {decision_result}
  
  ## 策略推荐
  {strategy_recommendation}
  
  ## Edge 评估
  {edge_analysis}
  
  ## 关键风险
  {risk_factors}
  
  请生成结构化报告，严格按照 JSON Schema 输出。

json_schema:
  type: object
  required:
    - executive_summary
    - market_analysis
    - recommendation
    - risk_assessment
    - action_items
  properties:
    executive_summary:
      type: string
      minLength: 80
      maxLength: 200
      description: 执行摘要（80-200字），包含决策、信心度、预期收益
    
    market_analysis:
      type: object
      required:
        - gex_assessment
        - volatility_assessment
        - term_structure_assessment
      properties:
        gex_assessment:
          type: object
          properties:
            regime:
              type: string
              enum:
                - positive_gex
                - negative_gex
                - neutral
            impact:
              type: string
              description: 对波动率交易的影响
            key_levels:
              type: array
              items:
                type: string
              description: 关键价位描述
        
        volatility_assessment:
          type: object
          properties:
            iv_level:
              type: string
              enum:
                - elevated
                - normal
                - depressed
            vrp:
              type: number
            vrp_interpretation:
              type: string
            hv_trend:
              type: string
        
        term_structure_assessment:
          type: object
          properties:
            shape:
              type: string
              enum:
                - contango
                - backwardation
                - flat
            slope:
              type: number
            interpretation:
              type: string
        
        skew_assessment:
          type: object
          properties:
            bias:
              type: string
              enum:
                - put_heavy
                - call_heavy
                - balanced
            asymmetry:
              type: number
            interpretation:
              type: string
    
    recommendation:
      type: object
      required:
        - decision
        - confidence
        - strategy
        - key_levels
      properties:
        decision:
          type: string
          enum:
            - long_vol
            - short_vol
            - hold
        confidence:
          type: string
          enum:
            - high
            - medium
            - low
        strategy:
          type: object
          properties:
            primary:
              type: string
            structure:
              type: string
              description: 具体结构描述
            dte:
              type: string
        key_levels:
          type: array
          items:
            type: object
            properties:
              level:
                type: number
              type:
                type: string
              significance:
                type: string
    
    risk_assessment:
      type: object
      required:
        - primary_risks
        - risk_mitigation
        - risk_reward_summary
      properties:
        primary_risks:
          type: array
          minItems: 1
          maxItems: 5
          items:
            type: object
            properties:
              risk:
                type: string
              probability:
                type: string
                enum:
                  - high
                  - medium
                  - low
              impact:
                type: string
                enum:
                  - severe
                  - moderate
                  - minor
        
        risk_mitigation:
          type: array
          items:
            type: string
          description: 风险缓解措施
        
        risk_reward_summary:
          type: object
          properties:
            max_loss:
              type: string
            target_profit:
              type: string
            expected_value:
              type: string
            win_rate:
              type: string
    
    action_items:
      type: array
      minItems: 1
      maxItems: 5
      items:
        type: object
        required:
          - action
          - priority
        properties:
          action:
            type: string
            description: 具体行动
          priority:
            type: string
            enum:
              - immediate
              - high
              - medium
              - low
          deadline:
            type: string
            description: 建议完成时间
          condition:
            type: string
            description: 触发条件（如有）

# 示例输出
example_output:
  executive_summary: |
    【AAPL 做空波动率】建议执行 Iron Condor 策略。
    ShortVolScore +1.35 显著高于 LongVolScore -0.62，
    VRP +5.5% 支持做空方向。预期胜率 62%，盈亏比 1.8:1。
    置信度: 中等。主要风险为财报事件。
  
  market_analysis:
    gex_assessment:
      regime: positive_gex
      impact: 正 GEX 环境压制实际波动，有利于期权卖方
      key_levels:
        - "Gamma Wall $185: 强支撑/阻力"
        - "VOL_TRIGGER $184: GEX 翻转点"
        - "Put Wall $180: 下方支撑"
    
    volatility_assessment:
      iv_level: elevated
      vrp: 5.5
      vrp_interpretation: IV 高于 HV，存在做空溢价
      hv_trend: HV10 > HV20 > HV60，短期波动上升
    
    term_structure_assessment:
      shape: backwardation
      slope: 2.0
      interpretation: 近月 IV 高于远月，支持卖近买远
    
    skew_assessment:
      bias: put_heavy
      asymmetry: 3.5
      interpretation: Put 保护需求较高，下行担忧存在
  
  recommendation:
    decision: short_vol
    confidence: medium
    strategy:
      primary: Iron Condor
      structure: "180/175 Put Spread + 195/200 Call Spread"
      dte: "30-45 DTE"
    key_levels:
      - level: 185
        type: gamma_wall
        significance: 主要磁吸价位，价格倾向于此处震荡
      - level: 180
        type: put_wall
        significance: 下方强支撑，Put Spread 短腿位置
      - level: 195
        type: call_wall
        significance: 上方阻力，Call Spread 短腿位置
  
  risk_assessment:
    primary_risks:
      - risk: 财报事件导致 IV 飙升
        probability: medium
        impact: severe
      - risk: 突破 VOL_TRIGGER 导致波动放大
        probability: low
        impact: moderate
      - risk: 流动性不足导致滑点
        probability: low
        impact: minor
    
    risk_mitigation:
      - 避免在财报前 5 天内建仓
      - 设置标的价格触及短腿行权价时止损
      - 分批建仓，避免单次大额入场
    
    risk_reward_summary:
      max_loss: "$500 (Spread Width - Premium)"
      target_profit: "$250 (50% of Premium)"
      expected_value: "$125"
      win_rate: "62%"
  
  action_items:
    - action: 确认无重大事件在 DTE 内
      priority: immediate
      deadline: 建仓前
    - action: 检查期权链流动性
      priority: high
      deadline: 建仓前
    - action: 以 Limit Order 分批建仓
      priority: high
      condition: IV > HV20 + 3%
    - action: 设置 50% 利润止盈单
      priority: medium
      deadline: 建仓后立即
    - action: 每日监控 GEX 变化
      priority: medium
